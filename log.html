<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRPG跑团日志查看器</title>
    <link rel="stylesheet" href="css/log-viewer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        <!-- 顶部导航栏 -->
        <header class="header">
            <div class="header-left">
                <a href="index.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i> 返回日志列表
                </a>
                <h1>{{ logData.title || 'TRPG跑团日志' }}</h1>
                <span class="meta">{{ logData.date || '' }} | 共 {{ messages.length }} 条消息</span>
            </div>
            
            <div class="header-right">
                <!-- 搜索框 -->
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input 
                        type="text" 
                        v-model="searchKeyword" 
                        placeholder="搜索消息内容或角色名..." 
                        @input="onSearch"
                    >
                    <button v-if="searchKeyword" @click="clearSearch" class="clear-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- 章节导航按钮 -->
                <button @click="toggleChapterNav" class="nav-btn">
                    <i class="fas" :class="showChapterNav ? 'fa-list' : 'fa-bars'"></i>
                    章节
                </button>
                
                <!-- 筛选按钮 -->
                <button @click="toggleFilterPanel" class="filter-btn">
                    <i class="fas fa-filter"></i>
                    筛选
                    <span v-if="filterCount > 0" class="badge">{{ filterCount }}</span>
                </button>
            </div>
        </header>
        
        <!-- 筛选面板 -->
        <div v-if="showFilterPanel" class="filter-panel">
            <div class="filter-group">
                <h4>角色筛选</h4>
                <div class="filter-options">
                    <label v-for="character in characterList" :key="character">
                        <input type="checkbox" v-model="filters.characters" :value="character">
                        {{ character }}
                    </label>
                </div>
            </div>
            
            <div class="filter-group">
                <h4>频道筛选</h4>
                <div class="filter-options">
                    <label v-for="channel in channelList" :key="channel">
                        <input type="checkbox" v-model="filters.channels" :value="channel">
                        {{ channel }}
                    </label>
                </div>
            </div>
            
            <div class="filter-actions">
                <button @click="applyFilters" class="apply">应用</button>
                <button @click="resetFilters" class="reset">重置</button>
            </div>
        </div>
        
        <!-- 主要内容区 -->
        <div class="main-container">
            <!-- 左侧章节导航 -->
            <aside v-if="showChapterNav" class="sidebar">
                <div class="sidebar-header">
                    <h3><i class="fas fa-bookmark"></i> 章节导航</h3>
                    <span class="count">{{ chapters.length }} 章</span>
                </div>
                
                <div class="chapter-list">
                    <div 
                        v-for="(chapter, index) in chapters" 
                        :key="index"
                        class="chapter-item"
                        :class="{ active: currentChapterIndex === index }"
                        @click="jumpToChapter(index)"
                    >
                        <div class="chapter-title">{{ chapter.title }}</div>
                        <div class="chapter-meta">
                            <span>第{{ index + 1 }}章</span>
                            <span>·</span>
                            <span>{{ chapter.messageCount }} 条</span>
                        </div>
                    </div>
                </div>
                
                <!-- 快速跳转 -->
                <div class="quick-jump">
                    <h4>快速跳转</h4>
                    <div class="jump-controls">
                        <input 
                            type="number" 
                            v-model="jumpPage" 
                            min="1" 
                            :max="totalPages"
                            placeholder="页码"
                        >
                        <button @click="jumpToPage">跳转</button>
                    </div>
                </div>
            </aside>
            
            <!-- 右侧日志内容 -->
            <main class="content">
                <!-- 章节标题 -->
                <div v-if="currentChapter" class="chapter-banner">
                    <h2 class="chapter-name">{{ currentChapter.title }}</h2>
                    <div class="chapter-info">
                        <span>第 {{ currentChapterIndex + 1 }} 章</span>
                        <span>·</span>
                        <span>第 {{ currentPageInChapter }} 页/共 {{ chapterTotalPages }} 页</span>
                        <span>·</span>
                        <span>{{ currentChapter.messageCount }} 条消息</span>
                    </div>
                </div>
                
                <!-- 筛选提示 -->
                <div v-if="hasActiveFilters" class="filter-tags">
                    <span v-if="searchKeyword" class="tag">
                        搜索: "{{ searchKeyword }}"
                        <button @click="clearSearch" class="remove-tag">
                            <i class="fas fa-times"></i>
                        </button>
                    </span>
                    
                    <span v-if="filters.characters.length" class="tag">
                        角色: {{ filters.characters.length }} 个
                        <button @click="removeFilter('characters')" class="remove-tag">
                            <i class="fas fa-times"></i>
                        </button>
                    </span>
                    
                    <span v-if="filters.channels.length" class="tag">
                        频道: {{ filters.channels.length }} 个
                        <button @click="removeFilter('channels')" class="remove-tag">
                            <i class="fas fa-times"></i>
                        </button>
                    </span>
                    
                    <button @click="resetFilters" class="clear-all">
                        清除所有
                    </button>
                </div>
                
                <!-- 消息列表 -->
                <div class="messages">
                    <div v-if="filteredMessages.length === 0" class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>没有找到符合条件的消息</p>
                        <button @click="resetFilters">显示全部消息</button>
                    </div>
                    
                    <template v-else>
                        <!-- 分组显示消息 -->
                        <div v-for="(group, index) in messageGroups" :key="index" class="channel-block">
                            <!-- 章节标题 -->
                            <div v-if="group.isChapter" class="chapter-header" :style="getChapterStyle(group)">
                                <h3>{{ group.title }}</h3>
                            </div>
                            
                            <!-- 普通频道组 -->
                            <div v-else class="channel-group">
                                <div class="channel-name" :style="getChannelNameStyle(group.channel)">
                                    {{ group.channel }}
                                </div>
                                
                                <div class="channel-content">
                                    <div v-for="msg in group.messages" :key="msg.id" class="message">
                                        <!-- 头像 -->
                                        <div class="avatar">
                                            <img v-if="msg.icon" :src="msg.icon" @error="handleImageError">
                                        </div>
                                        
                                        <!-- 消息内容 -->
                                        <div class="message-body">
                                            <!-- 角色名 -->
                                            <div class="character-name" :style="getCharacterNameStyle(msg)">
                                                {{ msg.name }}
                                                <span v-if="msg.to" class="to"> > @{{ msg.to }}</span>
                                            </div>
                                            
                                            <!-- 消息气泡 -->
                                            <div class="bubble" :style="getBubbleStyle(msg)">
                                                <div class="text" :style="getTextStyle()">
                                                    {{ msg.text }}
                                                </div>
                                                
                                                <!-- 消息图片 -->
                                                <div v-if="msg.messageImage" class="message-image">
                                                    <img :src="msg.messageImage" @click="showImageModal(msg.messageImage)">
                                                </div>
                                                
                                                <!-- 骰子结果 -->
                                                <div v-if="msg.dice || msg.extend" class="dice-result" :style="getDiceStyle(msg)">
                                                    {{ formatDiceResult(msg) }}
                                                </div>
                                            </div>
                                            
                                            <!-- 时间 -->
                                            <div class="time">
                                                {{ formatTime(msg.time) }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- 分页控件 -->
                <div class="pagination">
                    <button @click="prevPage" :disabled="currentPage === 1">
                        <i class="fas fa-chevron-left"></i> 上一页
                    </button>
                    
                    <div class="page-info">
                        第 {{ currentPage }} 页 / 共 {{ totalPages }} 页
                        <span class="count">({{ startIndex + 1 }}-{{ Math.min(endIndex, filteredMessages.length) }} 条)</span>
                    </div>
                    
                    <button @click="nextPage" :disabled="currentPage === totalPages">
                        下一页 <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </main>
        </div>
        
        <!-- 图片预览模态框 -->
        <div v-if="showImageModal" class="modal" @click="closeImageModal">
            <div class="modal-content" @click.stop>
                <button @click="closeImageModal" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
                <img :src="modalImageUrl" alt="图片预览">
            </div>
        </div>
    </div>
    
    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    // 从JSON加载的数据
                    logData: {},
                    messages: [],
                    chapters: [],
                    
                    // 显示控制
                    showChapterNav: true,
                    showFilterPanel: false,
                    showImageModal: false,
                    modalImageUrl: '',
                    
                    // 分页
                    currentPage: 1,
                    pageSize: 20,
                    jumpPage: null,
                    
                    // 搜索和筛选
                    searchKeyword: '',
                    filters: {
                        characters: [],
                        channels: []
                    }
                };
            },
            computed: {
                // 日志基本信息
                logTitle() {
                    return this.logData.title || 'TRPG跑团日志';
                },
                
                logDate() {
                    return this.logData.date || '';
                },
                
                // 获取字体设置（从JSON）
                fontSettings() {
                    return this.logData.fontSettings || {};
                },
                
                // 获取频道规则（从JSON）
                channelRules() {
                    return this.logData.channelRules || {};
                },
                
                // 获取角色规则（从JSON）
                characterRules() {
                    return this.logData.characterRules || {};
                },
                
                // 获取章节设置（从JSON）
                chapterSettings() {
                    return this.logData.chapterSettings || {};
                },
                
                // 获取extend格式设置（从JSON）
                extendFormats() {
                    return this.logData.extendFormats || {};
                },
                
                // 获取system消息设置（从JSON）
                systemSettings() {
                    return this.logData.systemSettings || {};
                },
                
                // 角色列表
                characterList() {
                    const characters = new Set();
                    this.messages.forEach(msg => {
                        if (msg.name && msg.name.toLowerCase() !== 'system') {
                            characters.add(msg.name);
                        }
                    });
                    return Array.from(characters).sort();
                },
                
                // 频道列表
                channelList() {
                    const channels = new Set();
                    this.messages.forEach(msg => {
                        if (msg.channel) {
                            channels.add(msg.channel);
                        }
                    });
                    return Array.from(channels).sort();
                },
                
                // 筛选后的消息
                filteredMessages() {
                    return this.messages.filter(msg => {
                        // 搜索筛选
                        if (this.searchKeyword) {
                            const keyword = this.searchKeyword.toLowerCase();
                            const textMatch = msg.text?.toLowerCase().includes(keyword);
                            const nameMatch = msg.name?.toLowerCase().includes(keyword);
                            if (!textMatch && !nameMatch) {
                                return false;
                            }
                        }
                        
                        // 角色筛选
                        if (this.filters.characters.length > 0) {
                            if (!this.filters.characters.includes(msg.name)) {
                                return false;
                            }
                        }
                        
                        // 频道筛选
                        if (this.filters.channels.length > 0) {
                            if (!this.filters.channels.includes(msg.channel)) {
                                return false;
                            }
                        }
                        
                        return true;
                    });
                },
                
                // 分页计算
                totalPages() {
                    return Math.ceil(this.filteredMessages.length / this.pageSize);
                },
                
                startIndex() {
                    return (this.currentPage - 1) * this.pageSize;
                },
                
                endIndex() {
                    return this.startIndex + this.pageSize;
                },
                
                // 当前页的消息
                paginatedMessages() {
                    return this.filteredMessages.slice(this.startIndex, this.endIndex);
                },
                
                // 按频道分组
                messageGroups() {
                    const groups = [];
                    let currentGroup = null;
                    
                    this.paginatedMessages.forEach(msg => {
                        // 章节消息单独分组
                        if (msg.isChapter) {
                            if (currentGroup) {
                                groups.push(currentGroup);
                            }
                            groups.push({
                                isChapter: true,
                                title: msg.text.replace('=== ', '').replace(' ===', ''),
                                style: this.getChapterStyle(msg)
                            });
                            currentGroup = null;
                        } else {
                            const channel = msg.channel || '默认频道';
                            
                            if (!currentGroup || channel !== currentGroup.channel) {
                                if (currentGroup) {
                                    groups.push(currentGroup);
                                }
                                currentGroup = {
                                    channel: channel,
                                    messages: [msg],
                                    style: this.getChannelStyle(channel)
                                };
                            } else {
                                currentGroup.messages.push(msg);
                            }
                        }
                    });
                    
                    if (currentGroup) {
                        groups.push(currentGroup);
                    }
                    
                    return groups;
                },
                
                // 当前章节索引
                currentChapterIndex() {
                    if (!this.chapters.length) return 0;
                    
                    const currentMessageIndex = (this.currentPage - 1) * this.pageSize;
                    for (let i = this.chapters.length - 1; i >= 0; i--) {
                        if (currentMessageIndex >= this.chapters[i].startIndex) {
                            return i;
                        }
                    }
                    return 0;
                },
                
                // 当前章节
                currentChapter() {
                    return this.chapters[this.currentChapterIndex];
                },
                
                // 章节内的页码
                currentPageInChapter() {
                    if (!this.currentChapter) return 1;
                    
                    const chapterStart = this.currentChapter.startIndex;
                    const currentIndex = (this.currentPage - 1) * this.pageSize;
                    return Math.floor((currentIndex - chapterStart) / this.pageSize) + 1;
                },
                
                // 章节总页数
                chapterTotalPages() {
                    if (!this.currentChapter) return 1;
                    return Math.ceil(this.currentChapter.messageCount / this.pageSize);
                },
                
                // 筛选计数
                filterCount() {
                    let count = 0;
                    count += this.filters.characters.length;
                    count += this.filters.channels.length;
                    if (this.searchKeyword) count += 1;
                    return count;
                },
                
                // 是否有活跃筛选
                hasActiveFilters() {
                    return this.filterCount > 0;
                }
            },
            methods: {
                // 初始化
                async init() {
                    // 从URL获取日志文件名
                    const urlParams = new URLSearchParams(window.location.search);
                    const logFile = urlParams.get('log') || 'log_001.json';
                    
                    await this.loadLogData(logFile);
                    this.processChapters();
                },
                
                // 加载日志数据
                async loadLogData(filename) {
                    try {
                        const response = await fetch(`data/${filename}`);
                        this.logData = await response.json();
                        
                        // 确保消息数组存在
                        this.messages = this.logData.logs || [];
                        
                        console.log(`成功加载 ${this.messages.length} 条消息`);
                        console.log('包含的设置:', {
                            fontSettings: !!this.logData.fontSettings,
                            channelRules: !!this.logData.channelRules,
                            characterRules: !!this.logData.characterRules,
                            chapters: (this.logData.chapters || []).length
                        });
                    } catch (error) {
                        console.error('加载日志数据失败:', error);
                        alert('无法加载日志数据，请检查文件是否存在');
                    }
                },
                
                // 处理章节
                processChapters() {
                    this.chapters = [];
                    
                    // 如果JSON中有章节数据，直接使用
                    if (this.logData.chapters && Array.isArray(this.logData.chapters)) {
                        this.chapters = this.logData.chapters;
                    } else {
                        // 否则从消息中提取章节
                        const chapterMessages = this.messages.filter(msg => msg.isChapter);
                        chapterMessages.forEach((msg, index) => {
                            const startIndex = this.messages.findIndex(m => m.id === msg.id);
                            const nextStart = chapterMessages[index + 1] ? 
                                this.messages.findIndex(m => m.id === chapterMessages[index + 1].id) : 
                                this.messages.length;
                            
                            this.chapters.push({
                                title: msg.text.replace('=== ', '').replace(' ===', ''),
                                startIndex: startIndex,
                                messageCount: nextStart - startIndex
                            });
                        });
                        
                        // 如果没有章节，创建一个默认章节
                        if (this.chapters.length === 0) {
                            this.chapters.push({
                                title: '完整的冒险',
                                startIndex: 0,
                                messageCount: this.messages.length
                            });
                        }
                    }
                    
                    console.log(`识别到 ${this.chapters.length} 个章节`);
                },
                
                // 获取章节样式（从JSON设置）
                getChapterStyle(chapterMsg) {
                    const settings = this.chapterSettings;
                    const style = {};
                    
                    // 字体设置
                    if (settings.fontFamily) {
                        style.fontFamily = settings.fontFamily;
                    }
                    if (settings.color) {
                        style.color = settings.color;
                    }
                    if (settings.fontSize) {
                        style.fontSize = `${settings.fontSize}px`;
                    }
                    if (settings.bold) {
                        style.fontWeight = 'bold';
                    }
                    if (settings.shadow) {
                        style.textShadow = '1px 1px 2px rgba(0,0,0,0.3)';
                    }
                    
                    // 背景设置
                    if (settings.useImage && settings.image) {
                        style.backgroundImage = `url(${settings.image})`;
                        style.backgroundSize = settings.imageSize || 'cover';
                        style.backgroundPosition = 'center';
                        if (settings.imageOpacity !== undefined) {
                            style.opacity = settings.imageOpacity;
                        }
                    } else if (settings.backgroundColor) {
                        style.backgroundColor = settings.backgroundColor;
                        if (settings.backgroundOpacity !== undefined) {
                            style.opacity = settings.backgroundOpacity;
                        }
                    }
                    
                    return style;
                },
                
                // 获取频道样式
                getChannelStyle(channelName) {
                    const rule = this.channelRules[channelName];
                    const style = {};
                    
                    if (rule) {
                        if (rule.useImage && rule.image) {
                            style.backgroundImage = `url(${rule.image})`;
                            style.backgroundSize = rule.imageSize || 'cover';
                            if (rule.imageOpacity !== undefined) {
                                style.opacity = rule.imageOpacity;
                            }
                        } else if (rule.color) {
                            const opacity = rule.opacity || 0.1;
                            style.backgroundColor = this.hexToRgba(rule.color, opacity);
                        }
                    }
                    
                    return style;
                },
                
                // 获取频道名字体样式
                getChannelNameStyle(channelName) {
                    const style = {};
                    const settings = this.fontSettings;
                    
                    if (settings.channelName) {
                        style.fontFamily = settings.channelName;
                    }
                    if (settings.channelNameColor) {
                        style.color = settings.channelNameColor;
                    }
                    if (settings.channelNameSize) {
                        style.fontSize = `${settings.channelNameSize}px`;
                    }
                    
                    return style;
                },
                
                // 获取角色名字体样式
                getCharacterNameStyle(msg) {
                    const style = {};
                    const settings = this.fontSettings;
                    
                    // 字体
                    if (settings.characterName) {
                        style.fontFamily = settings.characterName;
                    }
                    if (settings.characterNameSize) {
                        style.fontSize = `${settings.characterNameSize}px`;
                    }
                    
                    // 颜色（优先从角色规则获取，否则从消息获取）
                    const characterRule = this.characterRules[msg.name];
                    if (characterRule && characterRule.nameColor) {
                        style.color = characterRule.nameColor;
                    } else if (msg.color) {
                        style.color = msg.color;
                    }
                    
                    return style;
                },
                
                // 获取气泡样式
                getBubbleStyle(msg) {
                    const style = {};
                    const characterRule = this.characterRules[msg.name];
                    
                    // 检查消息级别的设置
                    if (msg.bubbleUseImage && msg.bubbleImage) {
                        style.backgroundImage = `url(${msg.bubbleImage})`;
                        style.backgroundSize = msg.bubbleImageSize || 'cover';
                        if (msg.bubbleImageOpacity !== undefined) {
                            style.opacity = msg.bubbleImageOpacity;
                        }
                    } else if (msg.bubbleColor) {
                        const opacity = msg.bubbleOpacity || 0.85;
                        style.backgroundColor = this.hexToRgba(msg.bubbleColor, opacity);
                    }
                    // 检查角色规则
                    else if (characterRule) {
                        if (characterRule.bubbleUseImage && characterRule.bubbleImage) {
                            style.backgroundImage = `url(${characterRule.bubbleImage})`;
                            style.backgroundSize = characterRule.bubbleImageSize || 'cover';
                            if (characterRule.bubbleImageOpacity !== undefined) {
                                style.opacity = characterRule.bubbleImageOpacity;
                            }
                        } else if (characterRule.bubbleColor) {
                            const opacity = characterRule.bubbleOpacity || 0.85;
                            style.backgroundColor = this.hexToRgba(characterRule.bubbleColor, opacity);
                        }
                    }
                    
                    return style;
                },
                
                // 获取文本样式
                getTextStyle() {
                    const style = {};
                    const settings = this.fontSettings;
                    
                    if (settings.dialogText) {
                        style.fontFamily = settings.dialogText;
                    }
                    if (settings.dialogTextColor) {
                        style.color = settings.dialogTextColor;
                    }
                    if (settings.dialogTextSize) {
                        style.fontSize = `${settings.dialogTextSize}px`;
                    }
                    
                    return style;
                },
                
                // 获取骰子结果样式
                getDiceStyle(msg) {
                    const style = {};
                    const settings = this.fontSettings;
                    const extendSettings = this.extendFormats;
                    
                    // 基础样式
                    if (settings.extendText) {
                        style.fontFamily = settings.extendText;
                    }
                    if (settings.extendTextColor) {
                        style.color = settings.extendTextColor;
                    }
                    if (settings.extendTextSize) {
                        style.fontSize = `${settings.extendTextSize}px`;
                    }
                    
                    // 根据骰子结果类型应用特殊格式
                    const resultType = this.getDiceResultType(msg);
                    if (resultType && extendSettings[resultType]) {
                        const format = extendSettings[resultType];
                        if (format.color) {
                            style.color = format.color;
                        }
                        if (format.fontFamily) {
                            style.fontFamily = format.fontFamily;
                        }
                        if (format.fontSize) {
                            style.fontSize = `${format.fontSize}px`;
                        }
                        if (format.bold) {
                            style.fontWeight = 'bold';
                        }
                    }
                    
                    return style;
                },
                
                // 判断骰子结果类型
                getDiceResultType(msg) {
                    const diceText = msg.dice || '';
                    if (diceText.includes('大失败')) return 'criticalFailure';
                    if (diceText.includes('大成功')) return 'criticalSuccess';
                    if (diceText.endsWith('成功')) return 'success';
                    if (diceText.endsWith('失败')) return 'failure';
                    return null;
                },
                
                // 格式化骰子结果
                formatDiceResult(msg) {
                    return msg.dice || '';
                },
                
                // 工具函数
                hexToRgba(hex, opacity) {
                    if (!hex) return `rgba(255,255,255,${opacity})`;
                    
                    hex = hex.replace(/^#/, '');
                    if (hex.length === 3) {
                        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
                    }
                    
                    const r = parseInt(hex.substring(0, 2), 16);
                    const g = parseInt(hex.substring(2, 4), 16);
                    const b = parseInt(hex.substring(4, 6), 16);
                    
                    return `rgba(${r},${g},${b},${opacity})`;
                },
                
                formatTime(timeString) {
                    if (!timeString) return '';
                    try {
                        const date = new Date(timeString);
                        return date.toLocaleString('zh-CN', {
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    } catch (e) {
                        return timeString;
                    }
                },
                
                // 搜索和筛选
                onSearch() {
                    this.currentPage = 1;
                },
                
                clearSearch() {
                    this.searchKeyword = '';
                    this.currentPage = 1;
                },
                
                toggleFilterPanel() {
                    this.showFilterPanel = !this.showFilterPanel;
                },
                
                applyFilters() {
                    this.showFilterPanel = false;
                    this.currentPage = 1;
                },
                
                resetFilters() {
                    this.searchKeyword = '';
                    this.filters = {
                        characters: [],
                        channels: []
                    };
                    this.currentPage = 1;
                },
                
                removeFilter(type) {
                    this.filters[type] = [];
                    this.currentPage = 1;
                },
                
                // 章节导航
                toggleChapterNav() {
                    this.showChapterNav = !this.showChapterNav;
                },
                
                jumpToChapter(index) {
                    if (index >= 0 && index < this.chapters.length) {
                        const chapter = this.chapters[index];
                        const pageNumber = Math.floor(chapter.startIndex / this.pageSize) + 1;
                        this.currentPage = pageNumber;
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },
                
                // 分页
                prevPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },
                
                nextPage() {
                    if (this.currentPage < this.totalPages) {
                        this.currentPage++;
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },
                
                jumpToPage() {
                    if (this.jumpPage >= 1 && this.jumpPage <= this.totalPages) {
                        this.currentPage = this.jumpPage;
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        this.jumpPage = null;
                    }
                },
                
                // 图片处理
                showImageModal(url) {
                    this.modalImageUrl = url;
                    this.showImageModal = true;
                },
                
                closeImageModal() {
                    this.showImageModal = false;
                    this.modalImageUrl = '';
                },
                
                handleImageError(event) {
                    event.target.style.display = 'none';
                }
            },
            
            mounted() {
                this.init();
            }
        }).mount('#app');
    </script>
</body>
</html>
